/*!
 * CronManager - Create and run cronjobs within the manager
 * Version: 1.3.0
 * Build date: 2022-09-09
 */
var cronmanager=function(e){cronmanager.superclass.constructor.call(this,e=e||{})};Ext.extend(cronmanager,Ext.Component,{initComponent:function(){this.stores={},this.ajax=new Ext.data.Connection({disableCaching:!0})},page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},util:{},form:{}}),Ext.reg("cronmanager",cronmanager),(CronManager=new cronmanager).combo.Snippets=function(e){e=e||{},Ext.applyIf(e,{name:"snippet",hiddenName:"snippet",displayField:"name",valueField:"id",fields:["id","name"],pageSize:20,minChars:1,editable:!0,triggerAction:"all",typeAhead:!0,forceSelection:!0,selectOnFocus:!1,url:CronManager.config.connectorUrl,baseParams:{action:"mgr/snippets/getlist",combo:!0},emptyText:_("cronmanager.selectasnippet")}),CronManager.combo.Snippets.superclass.constructor.call(this,e)},Ext.extend(CronManager.combo.Snippets,MODx.combo.ComboBox),Ext.reg("cronmanager-combo-snippets",CronManager.combo.Snippets),CronManager.combo.Error=function(e){e=e||{},Ext.applyIf(e,{store:new Ext.data.SimpleStore({fields:["d","v"],data:[[_("cronmanager.logs_filter_all"),"all"],[_("cronmanager.logs_filter_no_error"),"0"],[_("cronmanager.logs_filter_error"),"1"]]}),displayField:"d",valueField:"v",value:"all",mode:"local",name:"error",hiddenName:"error",triggerAction:"all",editable:!1,selectOnFocus:!1,listWidth:0}),CronManager.combo.Error.superclass.constructor.call(this,e)},Ext.extend(CronManager.combo.Error,Ext.form.ComboBox),Ext.reg("cronmanager-combo-error",CronManager.combo.Error),CronManager.util.dateRenderer=function(e){return function(e){var t;return"string"==typeof e&&""!==e&&Date.parseDate(e,"Y-m-d H:i:s")?(t=t||MODx.config.manager_date_format+" "+MODx.config.manager_time_format,Ext.util.Format.date(e,t)):e}},CronManager.panel.Home=function(e){e=e||{},Ext.applyIf(e,{cls:"container home-panel"+(CronManager.config.debug?" debug":"")+" modx"+CronManager.config.modxversion,defaults:{collapsible:!1,autoHeight:!0},items:[{html:"<h2>"+_("cronmanager")+"</h2>"+(CronManager.config.debug?'<div class="ribbon top-right"><span>'+_("cronmanager.debug_mode")+"</span></div>":""),border:!1,cls:"modx-page-header"},{defaults:{autoHeight:!0},border:!0,items:[{xtype:"cronmanager-panel-overview"}]},{cls:"treehillstudio_about",html:'<img width="146" height="40" src="'+CronManager.config.assetsUrl+'img/mgr/treehill-studio-small.png" srcset="'+CronManager.config.assetsUrl+'img/mgr/treehill-studio-small@2x.png 2x" alt="Treehill Studio">',listeners:{afterrender:function(){this.getEl().select("img").on("click",function(){var e='<span style="display: inline-block; text-align: center">&copy; 2011-2019 by <a href="https://oostdesign.com/" target="_blank">OostDesign</a><br><img src="'+CronManager.config.assetsUrl+'img/mgr/treehill-studio.png" srcset="'+CronManager.config.assetsUrl+'img/mgr/treehill-studio@2x.png 2x" alt="Treehill Studio" style="margin-top: 10px"><br>&copy; 2019-2022 by <a href="https://treehillstudio.com" target="_blank">Treehill Studio</a></span>';Ext.Msg.show({title:_("cronmanager")+" "+CronManager.config.version,msg:e,buttons:Ext.Msg.OK,cls:"treehillstudio_window",width:358})})}}}]}),CronManager.panel.Home.superclass.constructor.call(this,e)},Ext.extend(CronManager.panel.Home,MODx.Panel),Ext.reg("cronmanager-panel-home",CronManager.panel.Home),CronManager.panel.HomeTab=function(e){e=e||{},Ext.applyIf(e,{id:"cronmanager-panel-"+e.tabtype,title:e.title,items:[{html:"<p>"+e.description+"</p>",border:!1,cls:"panel-desc"},{layout:"form",cls:"x-form-label-left main-wrapper",defaults:{autoHeight:!0},border:!0,items:[{id:"cronmanager-panel-"+e.tabtype+"-grid",xtype:"cronmanager-grid-"+e.tabtype,preventRender:!0}]}]}),CronManager.panel.HomeTab.superclass.constructor.call(this,e)},Ext.extend(CronManager.panel.HomeTab,MODx.Panel),Ext.reg("cronmanager-panel-hometab",CronManager.panel.HomeTab),CronManager.panel.Overview=function(e){e=e||{},this.ident="cronmanager-panel-overview-"+Ext.id(),this.panelOverviewTabs=[{xtype:"cronmanager-panel-hometab",title:_("cronmanager.cronjobs"),description:_("cronmanager.cronjobs_desc"),tabtype:"cronjobs"},{xtype:"cronmanager-panel-hometab",title:_("cronmanager.cronjoblog"),description:_("cronmanager.cronjoblog_desc"),tabtype:"cronjoblog"}],CronManager.config.is_admin&&this.panelOverviewTabs.push({xtype:"cronmanager-panel-settings"}),Ext.applyIf(e,{id:this.ident,items:[{xtype:"modx-tabs",border:!0,stateful:!0,stateId:"cronmanager-panel-overview",stateEvents:["tabchange"],getState:function(){return{activeTab:this.items.indexOf(this.getActiveTab())}},autoScroll:!0,deferredRender:!1,forceLayout:!0,defaults:{layout:"form",autoHeight:!0,hideMode:"offsets"},items:this.panelOverviewTabs,listeners:{tabchange:function(e,t){"cronmanager-panel-settings"===t.xtype?Ext.getCmp("cronmanager-grid-system-settings").getStore().reload():"cronmanager-panel-hometab"===t.xtype&&Ext.getCmp("cronmanager-panel-"+t.tabtype+"-grid")&&Ext.getCmp("cronmanager-panel-"+t.tabtype+"-grid").getStore().reload()}}}]}),CronManager.panel.Overview.superclass.constructor.call(this,e)},Ext.extend(CronManager.panel.Overview,MODx.Panel),Ext.reg("cronmanager-panel-overview",CronManager.panel.Overview),CronManager.panel.Settings=function(e){e=e||{},MODx.request.ns="cronmanager",Ext.applyIf(e,{id:"cronmanager-panel-settings",title:_("cronmanager.settings"),items:[{html:"<p>"+_("cronmanager.settings_desc")+"</p>",border:!1,cls:"panel-desc"},{xtype:"cronmanager-grid-system-settings",id:"cronmanager-grid-system-settings",cls:"main-wrapper",preventSaveRefresh:!0}]}),CronManager.panel.Settings.superclass.constructor.call(this,e)},Ext.extend(CronManager.panel.Settings,MODx.Panel),Ext.reg("cronmanager-panel-settings",CronManager.panel.Settings),CronManager.grid.SystemSettings=function(e){(e=e||{}).baseParams={action:"system/settings/getList",namespace:"cronmanager",area:MODx.request.area},e.tbar=[],CronManager.grid.SystemSettings.superclass.constructor.call(this,e)},Ext.extend(CronManager.grid.SystemSettings,MODx.grid.SettingsGrid,{_showMenu:function(e,t,r){r.stopEvent(),r.preventDefault(),this.menu.record=this.getStore().getAt(t).data,this.getSelectionModel().isSelected(t)||this.getSelectionModel().selectRow(t),this.menu.removeAll();t=[];this.menu.record.menu?t=this.menu.record.menu:t.push({text:_("setting_update")||_("edit"),handler:this.updateSetting}),0<t.length&&(this.addContextMenuItem(t),this.menu.showAt(r.xy))},updateSetting:function(e,t){var r=this.menu.record,n=(r.fk=Ext.isDefined(this.config.fk)?this.config.fk:0,MODx.load({xtype:"modx-window-setting-update",url:CronManager.config.connectorUrl,action:"mgr/settings/update",record:r,grid:this,listeners:{success:{fn:function(){this.refresh()},scope:this}}}));n.reset(),n.setValues(r),n.show(t.target)},clearFilter:function(){var e="cronmanager",t=MODx.request.area||"",r=(this.getStore().baseParams=this.initialConfig.baseParams,Ext.getCmp("modx-filter-area"));r&&(r.store.baseParams.namespace=e,r.store.load(),r.reset()),Ext.getCmp("modx-filter-namespace").setValue(e),Ext.getCmp("modx-filter-key").reset(),this.getStore().baseParams.namespace=e,this.getStore().baseParams.area=t,this.getStore().baseParams.key="",this.getBottomToolbar().changePage(1)},filterByKey:function(e,t,r){return this.getStore().baseParams.key=t,this.getStore().baseParams.namespace="cronmanager",this.getBottomToolbar().changePage(1),!0},filterByNamespace:function(e,t,r){this.getStore().baseParams.namespace="cronmanager",this.getStore().baseParams.area="",this.getBottomToolbar().changePage(1);var n,o=Ext.getCmp("modx-filter-area");o&&((n=o.store).baseParams.namespace="cronmanager",n.removeAll(),n.load(),o.setValue(""))},listeners:{afterrender:function(){Ext.getCmp("modx-filter-namespace").hide()}}}),Ext.reg("cronmanager-grid-system-settings",CronManager.grid.SystemSettings),CronManager.grid.CronJobs=function(e){e=e||{},this.buttonColumnTpl=new Ext.XTemplate('<tpl for="."><tpl if="action_buttons !== null"><ul class="action-buttons"><tpl for="action_buttons"><li><i class="icon {className} icon-{icon}" title="{text}"></i></li></tpl></ul></tpl></tpl>',{compiled:!0}),this.ident="cronmanager-cronjobs-"+Ext.id(),Ext.applyIf(e,{id:this.ident+"-cronmanager-grid-cronjobs",url:CronManager.config.connectorUrl,baseParams:{action:"mgr/cronjobs/getlist"},autosave:!0,save_action:"mgr/cronjobs/updateFromGrid",fields:["id","snippet","snippet_name","properties","minutes","nextrun","lastrun","active","sortorder"],paging:!0,remoteSort:!0,autoExpandColumn:"snippet",emptyText:_("cronmanager.norecords"),showActionsColumn:!1,columns:[{header:_("cronmanager.snippet"),dataIndex:"snippet_name",sortable:!0},{header:_("cronmanager.minutes"),dataIndex:"minutes",sortable:!0,width:40,editor:{xtype:"numberfield",minValue:1,description:_("cronmanager.minutes_desc"),allowNegative:!1}},{header:_("cronmanager.lastrun"),dataIndex:"lastrun",sortable:!0,renderer:CronManager.util.dateRenderer()},{header:_("cronmanager.nextrun"),dataIndex:"nextrun",sortable:!0,renderer:CronManager.util.dateRenderer()},{header:_("cronmanager.active"),dataIndex:"active",sortable:!0,width:40,renderer:MODx.grid.Grid.prototype.rendYesNo,editor:{xtype:"combo-boolean"}},{header:_("id"),dataIndex:"id",hidden:!0,width:25},{renderer:{fn:this.buttonColumnRenderer,scope:this},menuDisabled:!0,width:30}],tbar:[{text:_("cronmanager.create"),cls:"primary-button",handler:this.createCronjob},{text:_("cronmanager.run_jobs"),cls:"secondary-button",handler:function(){this.runCronjobs()}},"->",{xtype:"textfield",id:this.ident+"-cronmanager-filter-search",emptyText:_("search")+"â€¦",submitValue:!1,listeners:{change:{fn:this.search,scope:this},render:{fn:function(e){new Ext.KeyMap(e.getEl(),{key:Ext.EventObject.ENTER,fn:function(){return this.fireEvent("change",this),this.blur(),!0},scope:e})},scope:this}}},{xtype:"button",id:this.ident+"-cronmanager-filter-clear",cls:"x-form-filter-clear",text:_("filter_clear"),listeners:{click:{fn:this.clearFilter,scope:this}}}]}),CronManager.grid.CronJobs.superclass.constructor.call(this,e)},Ext.extend(CronManager.grid.CronJobs,MODx.grid.Grid,{getMenu:function(){var e=[];e.push({text:_("cronmanager.update"),handler:this.updateCronjob}),e.push("-"),e.push({text:_("cronmanager.viewlog"),handler:this.viewlogCronjob}),e.push("-"),e.push({text:_("cronmanager.run_job"),handler:this.runCronjob}),e.push("-"),e.push({text:_("cronmanager.remove"),handler:this.removeCronjob}),this.addContextMenuItem(e)},createCronjob:function(e,t){this.createUpdateCronjob(e,t,!1)},updateCronjob:function(e,t){this.createUpdateCronjob(e,t,!0)},createUpdateCronjob:function(e,t,r){var n;if(r){if(!this.menu.record||!this.menu.record.id)return!1;n=this.menu.record}else n={parameter:"{}"};r=MODx.load({xtype:"cronmanager-window-cronjob-create-update",isUpdate:r,title:r?_("cronmanager.update"):_("cronmanager.create"),record:n,listeners:{success:{fn:this.refresh,scope:this}}});r.fp.getForm().setValues(n),r.show(t.target)},viewlogCronjob:function(e,t){if(!this.menu.record||!this.menu.record.id)return!1;var r=this.menu.record,n=MODx.load({xtype:"cronmanager-window-cronjob-viewlog",title:_("cronmanager.viewlog_title",{snippet:r.snippet_name}),record:r,listeners:{success:{fn:this.refresh,scope:this}}});n.fp.getForm().setValues(r),n.show(t.target)},removeCronjob:function(){if(!this.menu.record)return!1;MODx.msg.confirm({title:_("cronmanager.remove"),text:_("cronmanager.remove_confirm",{snippet:"<b>"+this.menu.record.snippet_name+"</b>"}),url:this.config.url,params:{action:"mgr/cronjobs/remove",id:this.menu.record.id},listeners:{success:{fn:this.refresh,scope:this}}})},runCronjob:function(){if(!this.menu.record)return!1;this.runCronjobs(this.menu.record.id)},runCronjobs:function(t=0){var e={cronjob_id:CronManager.config.cronjob_id},r=(t&&Ext.apply(e,{job:t}),CronManager.config.cronUrl+"?"+Ext.urlEncode(e));Ext.apply(e,{force:!0}),MODx.msg.confirm({title:t?_("cronmanager.run_job"):_("cronmanager.run_jobs"),text:t?_("cronmanager.run_job_confirm",{id:t}):_("cronmanager.run_jobs_confirm"),url:CronManager.config.cronUrl,params:e,listeners:{success:{fn:function(e){Ext.MessageBox.alert(t?_("cronmanager.job_started"):_("cronmanager.jobs_started"),r+"<br><br>"+(t?_("cronmanager.job_started_message",{id:t}):_("cronmanager.jobs_started_message"))),this.refresh},scope:this}}})},viewLog:function(){if(!this.menu.record||!this.menu.record.id)return!1;location.href="?a=logs&namespace="+CronManager.config.namespace+"&id="+this.menu.record.id},search:function(e){this.getStore().baseParams.query=e.getValue(),this.getBottomToolbar().changePage(1),this.refresh()},clearFilter:function(){this.getStore().baseParams.query="",Ext.getCmp(this.ident+"-cronmanager-filter-search").reset(),this.getBottomToolbar().changePage(1),this.refresh()},buttonColumnRenderer:function(){var e={action_buttons:[{className:"update",icon:"pencil-square-o",text:_("cronmanager.update")},{className:"viewlog",icon:"list-ul",text:_("cronmanager.viewlog")},{className:"run_job",icon:"rocket",text:_("cronmanager.run_job")},{className:"remove",icon:"trash-o",text:_("cronmanager.remove")}]};return this.buttonColumnTpl.apply(e)},onClick:function(e){var t=e.getTarget();if("icon"===t.className.split(" ")[0]){var t=t.className.split(" ")[1],r=this.getSelectionModel().getSelected();switch(this.menu.record=r.data,t){case"remove":this.removeCronjob(r,e);break;case"update":this.updateCronjob(r,e);break;case"run_job":this.runCronjob(r,e);break;case"viewlog":this.viewlogCronjob(r,e)}}}}),Ext.reg("cronmanager-grid-cronjobs",CronManager.grid.CronJobs),CronManager.window.CreateUpdateCronjob=function(e){e=e||{},this.ident="cronmanager-cronjob-createupdate-"+Ext.id(),Ext.applyIf(e,{id:this.ident,url:CronManager.config.connectorUrl,action:e.isUpdate?"mgr/cronjobs/update":"mgr/cronjobs/create",width:400,autoHeight:!0,closeAction:"close",cls:"modx-window cronmanager-window",fields:[{items:[{layout:"column",items:[{columnWidth:.6,layout:"form",items:[{xtype:"cronmanager-combo-snippets",fieldLabel:_("cronmanager.snippet"),name:"snippet",anchor:"100%",allowBlank:!1}]},{columnWidth:.2,layout:"form",items:[{xtype:"numberfield",fieldLabel:_("cronmanager.minutes"),description:_("cronmanager.minutes_desc"),name:"minutes",anchor:"100%",value:60,minValue:1,allowBlank:!1,allowNegative:!1}]},{columnWidth:.2,layout:"form",items:[{xtype:"xcheckbox",fieldLabel:_("cronmanager.active"),name:"active",hiddenName:"active",anchor:"100%"}]}]}]},{xtype:"textarea",fieldLabel:_("cronmanager.properties"),description:_("cronmanager.properties_desc"),name:"properties",anchor:"100%",allowBlank:!0,grow:!0,growMax:200},{xtype:"hidden",name:"id"}]}),CronManager.window.CreateUpdateCronjob.superclass.constructor.call(this,e)},Ext.extend(CronManager.window.CreateUpdateCronjob,MODx.Window),Ext.reg("cronmanager-window-cronjob-create-update",CronManager.window.CreateUpdateCronjob),CronManager.window.ViewlogCronjob=function(e){e=e||{},this.ident="cronmanager-cronjob-viewlog-"+Ext.id(),Ext.applyIf(e,{id:this.ident,width:900,autoHeight:!0,closeAction:"close",cls:"modx-window cronmanager-window",fields:[{xtype:"cronmanager-grid-cronjoblog",preventRender:!0,cronjob:e.record.id}],buttons:[{text:_("close"),scope:this,handler:this.close}]}),CronManager.window.ViewlogCronjob.superclass.constructor.call(this,e)},Ext.extend(CronManager.window.ViewlogCronjob,MODx.Window),Ext.reg("cronmanager-window-cronjob-viewlog",CronManager.window.ViewlogCronjob),CronManager.grid.CronJobLog=function(e){e=e||{},this.ident="cronmanager-cronjoblog-"+Ext.id(),this.sm=new Ext.grid.CheckboxSelectionModel,this.buttonColumnTpl=new Ext.XTemplate('<tpl for="."><tpl if="action_buttons !== null"><ul class="action-buttons"><tpl for="action_buttons"><li><i class="icon {className} icon-{icon}" title="{text}"></i></li></tpl></ul></tpl></tpl>',{compiled:!0}),Ext.applyIf(e,{id:this.ident+"-cronmanager-grid-cronjoblog",url:CronManager.config.connectorUrl,baseParams:{action:"mgr/cronjoblogs/getlist",cronjob:e.cronjob},fields:["id","logdate","message","day","error"],paging:!0,remoteSort:!0,autoExpandColumn:"message",grouping:!0,groupBy:"day",sortBy:"logdate",sortDir:"DESC",singleText:_("cronmanager.log_message"),pluralText:_("cronmanager.log_messages"),emptyText:_("cronmanager.log.norecords"),showActionsColumn:!1,sm:this.sm,height:600,autoHeight:!1,columns:[this.sm,{header:_("cronmanager.log_error"),dataIndex:"error",width:20,renderer:function(e,t){switch(e){case"":return"-";case!1:return t.css="green",_("no");case!0:return t.css="red",_("yes")}},hidden:!0},{header:_("cronmanager.log_day"),dataIndex:"day",width:30,hidden:!0},{header:_("cronmanager.log.date"),dataIndex:"logdate",width:40,sortable:!0,renderer:CronManager.util.dateRenderer()},{header:_("cronmanager.log.message"),dataIndex:"message",renderer:function(e){return"<pre>"+String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").substr(0,100)+(100<e.length?" ...":"")+"</pre>"},width:300,sortable:!0},{header:_("id"),dataIndex:"id",hidden:!0,width:25},{renderer:{fn:this.buttonColumnRenderer,scope:this},menuDisabled:!0,width:30}],tbar:[{xtype:"splitbutton",text:_("cronmanager.logs_actions"),menu:new Ext.menu.Menu({cls:"x-menu-no-icon",items:[{itemId:"log-action-purge",text:_("cronmanager.logs_purge_no_err"),handler:this.purgeLogs,scope:this},{itemId:"log-action-delete-selected",text:_("cronmanager.logs_delete_selected_one"),handler:this.deleteSelectedLogs,scope:this}]}),arrowHandler:this.setBulkActionsMenuState,handler:this.setBulkActionsMenuState},"->",{xtype:"cronmanager-combo-error",submitValue:!1,listeners:{select:{fn:this.filter,scope:this}}},{xtype:"textfield",id:this.ident+"-cronmanager-filter-search",emptyText:_("search")+"â€¦",submitValue:!1,listeners:{change:{fn:this.search,scope:this},render:{fn:function(e){new Ext.KeyMap(e.getEl(),{key:Ext.EventObject.ENTER,fn:function(){return this.fireEvent("change",this),this.blur(),!0},scope:e})},scope:this}}},{xtype:"button",id:this.ident+"-cronmanager-filter-clear",cls:"x-form-filter-clear",text:_("filter_clear"),listeners:{click:{fn:this.clearFilter,scope:this}}}]}),e.grouping&&Ext.applyIf(e,{view:new Ext.grid.GroupingView({forceFit:!0,hideGroupedColumn:!0,enableGroupingMenu:!1,enableNoGroups:!1,scrollOffset:0,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+(e.pluralText||_("records"))+'" : "'+(e.singleText||_("record"))+'"]})'})}),CronManager.grid.CronJobLog.superclass.constructor.call(this,e)},Ext.extend(CronManager.grid.CronJobLog,MODx.grid.Grid,{getMenu:function(e){var t,r=[],n=this.getSelectionModel().getCount();r.push({text:_("cronmanager.log_view_full"),handler:this.viewLog}),1<=n&&(t=1<n?_("cronmanager.logs_delete_selected"):_("cronmanager.logs_delete_selected_one"),r.push({text:t,handler:function(){var e=this.getSelectedAsList();if(!e)return!1;MODx.msg.confirm({title:t,text:1<n?_("cronmanager.logs_delete_selected_confirm",{n:n}):_("cronmanager.logs_delete_selected_confirm_one"),url:this.config.url,params:{action:"mgr/cronjoblogs/removeselected",ids:e},listeners:{success:{fn:function(e){this.refresh()},scope:this}}})}})),this.addContextMenuItem(r)},setBulkActionsMenuState:function(e){var t=this.getSelectionModel().getCount(),r=e.menu.getComponent("log-action-purge"),n=e.menu.getComponent("log-action-delete-selected"),o=1<t?_("cronmanager.logs_delete_selected"):_("cronmanager.logs_delete_selected_one");1<=t?n.enable():n.disable(),1<=this.getStore().getTotalCount()?r.enable():r.disable(),n.setText(o),e.showMenu()},viewLog:function(e,t){var r=MODx.load({xtype:"cronmanager-window-fulllog",title:this.menu.record.logdate,record:this.menu.record,listeners:{success:{fn:this.refresh,scope:this}}});r.setValues(this.menu.record),r.show(t.target)},purgeLogs:function(){var t=Ext.getCmp(this.ident+"-cronmanager-grid-cronjoblog");if(!t)return!1;MODx.msg.confirm({title:_("cronmanager.logs_purge_title"),text:_("cronmanager.logs_purge_confirm"),url:t.url,params:{action:"mgr/cronjoblogs/purgelogs",cronjob:t.baseParams.cronjob},listeners:{success:{fn:function(e){t.refresh()},scope:this}}})},deleteSelectedLogs:function(){var e=this.getSelectionModel().getCount(),t=this.getSelectedAsList();if(!1===t)return!1;MODx.msg.confirm({title:1<e?_("cronmanager.logs_delete_selected"):_("cronmanager.logs_delete_selected_one"),text:1<e?_("cronmanager.logs_delete_selected_confirm",{n:e}):_("cronmanager.logs_delete_selected_confirm_one"),url:this.config.url,params:{action:"mgr/cronjoblogs/removeselected",ids:t},listeners:{success:{fn:function(e){this.refresh()},scope:this}}})},search:function(e){this.getStore().baseParams.query=e.getValue(),this.getBottomToolbar().changePage(1),this.refresh()},clearFilter:function(){var e=this.getStore();e.baseParams.query="",e.baseParams.error="all",Ext.getCmp(this.ident+"-cronmanager-filter-search").reset(),this.getBottomToolbar().changePage(1),this.refresh()},filter:function(e,t){this.getStore().baseParams.error=t.data.v,this.getBottomToolbar().changePage(1),this.refresh()},buttonColumnRenderer:function(){var e={action_buttons:[{className:"fulllog",icon:"eye",text:_("cronmanager.log_view_full")}]};return this.buttonColumnTpl.apply(e)},onClick:function(e){var t,r=e.getTarget();"icon"===r.className.split(" ")[0]&&(r=r.className.split(" ")[1],t=this.getSelectionModel().getSelected(),this.menu.record=t.data,"fulllog"===r&&this.viewLog(t,e))}}),Ext.reg("cronmanager-grid-cronjoblog",CronManager.grid.CronJobLog),CronManager.window.FullLog=function(e){e=e||{},this.ident="cronmanager-cronjob-fulllog-"+Ext.id(),Ext.applyIf(e,{id:this.ident,width:750,autoHeight:!0,closeAction:"close",cls:"modx-window cronmanager-window",fields:[{xtype:"textarea",name:"message",anchor:"100%",readOnly:!0,height:300}],buttons:[{text:_("close"),scope:this,handler:this.close}]}),CronManager.window.FullLog.superclass.constructor.call(this,e)},Ext.extend(CronManager.window.FullLog,MODx.Window),Ext.reg("cronmanager-window-fulllog",CronManager.window.FullLog),CronManager.page.Home=function(e){e=e||{},Ext.applyIf(e,{buttons:[{text:_("help_ex"),handler:MODx.loadHelpPane}],components:[{xtype:"cronmanager-panel-home",renderTo:"cronmanager-panel-home"}]}),CronManager.page.Home.superclass.constructor.call(this,e)},Ext.extend(CronManager.page.Home,MODx.Component),Ext.reg("cronmanager-page-home",CronManager.page.Home);